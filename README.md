## Реализованные Unit - тесты

Реализация Unit тестов находится в файле SimpleCalculatorTest.cpp

#### Базовые арифметические операции
- **Add_CorrectResult**: Проверяет корректность операции сложения. Выполняет сложение `2 + 2` и ожидает результат `4`. Также проверяет, что в историю добавляется запись `"2 + 2 = 4"`.
- **Subtract_CorrectResult**: Проверяет корректность операции вычитания. Выполняет вычитание `5 - 3` и ожидает результат `2`. Проверяет запись в историю `"5 - 3 = 2"`.
- **Multiply_CorrectResult**: Проверяет корректность операции умножения. Выполняет умножение `4 * 3` и ожидает результат `12`. Проверяет запись в историю `"4 * 3 = 12"`.
- **Divide_CorrectResult**: Проверяет корректность операции деления. Выполняет деление `10 / 2` и ожидает результат `5`. Проверяет запись в историю `"10 / 2 = 5"`.

#### Деление с особыми случаями
- **Divide_ByZero_Throws**: Проверяет поведение при делении на ноль. Ожидает, что деление `10 / 0` вызовет исключение `std::exception`, так как текущее поведение не определено.
- **Divide_FractionalResult_Truncates**: Проверяет, что деление с дробным результатом усекается до целого числа. Выполняет деление `7 / 2`, ожидает результат `3` и запись в историю `"7 / 2 = 3"`.
- **Divide_ZeroNumerator**: Проверяет деление нуля на ненулевое число. Выполняет деление `0 / 5`, ожидает результат `0` и запись в историю `"0 / 5 = 0"`.
- **Divide_BoundaryValues**: Проверяет деление с граничными значениями. Выполняет деление `INT_MAX / 1` и `INT_MIN / 1`, ожидает корректные результаты и соответствующие записи в историю.

#### Операции с отрицательными числами
- **Add_NegativeNumbers**: Проверяет сложение отрицательных чисел. Выполняет `-2 + -3`, ожидает результат `-5` и запись в историю `"-2 + -3 = -5"`.
- **Subtract_NegativeNumbers**: Проверяет вычитание отрицательных чисел. Выполняет `-5 - -3`, ожидает результат `-2` и запись в историю `"-5 - -3 = -2"`.
- **Multiply_NegativeNumbers**: Проверяет умножение отрицательных чисел. Выполняет `-4 * -3`, ожидает результат `12` и запись в историю `"-4 * -3 = 12"`.
- **Divide_NegativeNumbers**: Проверяет деление отрицательных чисел. Выполняет `-10 / -2`, ожидает результат `5` и запись в историю `"-10 / -2 = 5"`.

#### Операции со смешанными числами
- **Add_MixedNumbers**: Проверяет сложение отрицательного и положительного числа. Выполняет `-2 + 5`, ожидает результат `3` и запись в историю `"-2 + 5 = 3"`.
- **Subtract_MixedNumbers**: Проверяет вычитание отрицательного числа из положительного. Выполняет `5 - -3`, ожидает результат `8` и запись в историю `"5 - -3 = 8"`.

#### Граничные значения
- **Add_BoundaryValues**: Проверяет сложение с граничными значениями `INT_MAX` и `INT_MIN`. Выполняет `INT_MAX + 0` и `INT_MIN + 0`, ожидает корректные результаты и записи в историю.
- **Multiply_BoundaryValues**: Проверяет умножение с граничными значениями `INT_MAX` и `INT_MIN`. Выполняет `INT_MAX * 1` и `INT_MIN * 1`, ожидает корректные результаты и записи в историю.

#### Переполнение
- **Add_Overflow_Throws**: Проверяет поведение при переполнении при сложении. Выполняет `INT_MAX + 1` и ожидает выброс исключения `std::overflow_error`.
- **Subtract_Overflow_Throws**: Проверяет переполнение при вычитании. Выполняет `INT_MIN - 1` и ожидает выброс исключения `std::overflow_error`.
- **Multiply_Overflow_Throws**: Проверяет переполнение при умножении. Выполняет `INT_MAX * 2` и ожидает выброс исключения `std::overflow_error`.

#### Операции с нулем
- **Add_Zero**: Проверяет сложение с нулем. Выполняет `5 + 0`, ожидает результат `5` и запись в историю `"5 + 0 = 5"`.
- **Multiply_Zero**: Проверяет умножение на ноль. Выполняет `5 * 0`, ожидает результат `0` и запись в историю `"5 * 0 = 0"`.

#### Взаимодействие с историей
- **MultipleOperations_LogsCorrectly**: Проверяет корректность логирования нескольких операций. Выполняет сложение `2 + 3`, вычитание `10 - 4` и умножение `5 * 2`, ожидает последовательные записи в историю.
- **SetHistory_LogsToNewHistory**: Проверяет установку новой истории. Устанавливает новую mock-историю, выполняет сложение `2 + 2` и проверяет, что запись `"2 + 2 = 4"` добавлена в новую историю.
- **SetHistory_MultipleCalls**: Проверяет многократную смену истории. Устанавливает три разные mock-истории, выполняет сложение для каждой и проверяет корректные записи в соответствующих историях.

### Тесты для InMemoryHistory

#### Базовая функциональность
- **AddEntry_StoresCorrectly**: Проверяет, что операции корректно сохраняются в истории. Добавляет две записи (`"2 + 2 = 4"`, `"5 - 3 = 2"`) и проверяет их наличие при запросе последних двух операций.
- **GetLastOperations_RespectsCount**: Проверяет, что запрос последних операций возвращает указанное количество записей. Добавляет три записи и запрашивает последние две, проверяя их порядок и содержимое.
- **GetLastOperations_MoreThanAvailable**: Проверяет поведение при запросе большего количества операций, чем доступно. Добавляет одну запись и запрашивает пять, ожидает только одну запись.
- **GetLastOperations_EmptyHistory**: Проверяет поведение при запросе операций из пустой истории. Ожидает пустой результат.
- **GetLastOperations_ZeroCount**: Проверяет запрос операций с нулевым количеством. Добавляет одну запись, но запрашивает ноль операций, ожидает пустой результат.
- **AddEntry_EmptyString**: Проверяет добавление пустой строки в историю. Добавляет пустую запись и проверяет, что она корректно сохраняется.
- **GetLastOperations_SingleEntryLargeCount**: Проверяет запрос большого количества операций при наличии одной записи. Ожидает возвращение только одной записи.

#### Нагрузочное тестирование
- **History_NoLimitDefined**: Проверяет поведение истории при добавлении большого количества записей (10000). Проверяет, что все записи сохраняются, но отмечает потенциальную проблему с неограниченным ростом памяти.

#### Некорректные входные данные
- **GetLastOperations_InvalidCount**: Проверяет поведение при запросе операций с некорректным количеством (отрицательное или очень большое). Ожидает, что будет возвращена одна доступная запись.

### Тесты с MockCalculator

#### Взаимодействие с историей
- **CalculatorMock_InteractsWithHistory**: Проверяет взаимодействие mock-калькулятора с реальной историей. Устанавливает историю, выполняет сложение `2 + 2`, возвращает `4` и проверяет запись в историю `"2 + 2 = 4"`.
- **CalculatorMock_MultipleOperations**: Проверяет выполнение нескольких операций mock-калькулятором. Выполняет сложение `2 + 2` и вычитание `5 - 3`, проверяет корректные записи в историю.


## Инструкция по развертке тестов
```bash
	sudo apt-get update
	sudo apt-get install -y libgtest-dev google-mock cmake build-essential
	cd /usr/src/gtest
	sudo mkdir -p build
	cd build
	sudo cmake ..
	sudo make
	ls lib
	sudo cp lib/*.a /usr/lib
	cd /usr/src/googletest
	sudo mkdir build
	cd build/
	sudo cmake ..
	sudo make
	sudo make install
	cd /folder/with/CalcGTest
	rm -rf build
	mkdir build
	cd build
	cmake ..
	make
	./runTests
```

## Обнаруженные проблемы в исходной библиотеке

### Переназначения ссылки

Член m_history в SimpleCalculator является ссылкой (IHistory&), которая инициализируется в конструкторе и не может быть изменена SetHistory. Метод SetHistory пытается переназначить ссылку, что недопустимо в C++ и приводит к неопределенному поведению или к тому, что исходная mockHistory все еще используется.

#### Исправление:

Чтобы исправить это, нам нужно изменить SimpleCalculator, чтобы разрешить изменение объекта истории. Поскольку ссылки не могут быть переназначены, мы можем:

1) Использовать указатель (IHistory*) вместо ссылки.

2) Сохранить ссылку, но создать новый экземпляр SimpleCalculator с новой историей.

### Отсутствие проверки деления на ноль

В строчке функции SimpleCalculator::Divide(int a, int b)

```bash

int result = a / b;

```

Если b == 0, то операция a / b вызовет Core Dumped.

#### Исправление:

Добавить проверку деления на ноль в функцию Divide(int a, int b)

```bash
	if (b == 0) {
	    throw std::invalid_argument("Division by zero"); 
	}
```

### Отсутствие проверки на переполнение

В функциях 
```bash
	int SimpleCalculator::Add(int a, int b)
	int SimpleCalculator::Subtract(int a, int b)
	int SimpleCalculator::Multiply(int a, int b)
```

Отсутствует проверка на переполнение для типа Int. Поэтому, если результат арифметической операции выходит за пределы диапазона типа Int, то возникает переполнение, что приводит к некорректному результату без явной ошибки.

#### Исправление:

Добавить проверку на переполнение в фукнции Add(int a, int b), Subtract(int a, int b), Multiply(int a, int b)

## Покрытие кода с помощью codecoverage
```bash
	Reading tracefile coverage_filtered.info.
	Found 6 entries.
	Found common filename prefix "/home/kali/Documents"
	Generating output.
	Processing file CalcGTest/IHistory.h
	lines=1 hit=1 functions=2 hit=1
	Processing file CalcGTest/ICalculator.h
	lines=1 hit=1 functions=2 hit=1
	Processing file CalcGTest/InMemoryHistory.h
	lines=1 hit=1 functions=1 hit=1
	Processing file CalcGTest/InMemoryHistory.cpp
	lines=6 hit=6 functions=2 hit=2
	Processing file CalcGTest/SimpleCalculatorTest.cpp
	lines=225 hit=222 functions=151 hit=148
	Processing file CalcGTest/SimpleCalculator.cpp
	lines=46 hit=41 functions=7 hit=7
	Overall coverage rate:
	source files: 6
	lines.......: 97.1% (272 of 280 lines)
	functions...: 97.0% (160 of 165 functions)
	Message summary:
	no messages were reported
```